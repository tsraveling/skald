{
  "$schema": "https://tree-sitter.github.io/tree-sitter/assets/schemas/grammar.schema.json",
  "name": "skald",
  "rules": {
    "source_file": {
      "type": "SEQ",
      "members": [
        {
          "type": "REPEAT",
          "content": {
            "type": "SYMBOL",
            "name": "variable_declaration"
          }
        },
        {
          "type": "REPEAT",
          "content": {
            "type": "SYMBOL",
            "name": "testbed"
          }
        },
        {
          "type": "REPEAT",
          "content": {
            "type": "SYMBOL",
            "name": "block"
          }
        }
      ]
    },
    "comment": {
      "type": "TOKEN",
      "content": {
        "type": "SEQ",
        "members": [
          {
            "type": "STRING",
            "value": "--"
          },
          {
            "type": "PATTERN",
            "value": ".*"
          }
        ]
      }
    },
    "variable_declaration": {
      "type": "SEQ",
      "members": [
        {
          "type": "CHOICE",
          "members": [
            {
              "type": "STRING",
              "value": "~"
            },
            {
              "type": "STRING",
              "value": "<"
            }
          ]
        },
        {
          "type": "FIELD",
          "name": "name",
          "content": {
            "type": "SYMBOL",
            "name": "variable_name"
          }
        },
        {
          "type": "STRING",
          "value": "="
        },
        {
          "type": "FIELD",
          "name": "value",
          "content": {
            "type": "SYMBOL",
            "name": "rvalue"
          }
        },
        {
          "type": "PATTERN",
          "value": "\\n"
        }
      ]
    },
    "variable_name": {
      "type": "PATTERN",
      "value": "[a-zA-Z_][a-zA-Z0-9_]*"
    },
    "testbed": {
      "type": "SEQ",
      "members": [
        {
          "type": "STRING",
          "value": "@testbed"
        },
        {
          "type": "FIELD",
          "name": "name",
          "content": {
            "type": "SYMBOL",
            "name": "identifier"
          }
        },
        {
          "type": "PATTERN",
          "value": "\\n"
        },
        {
          "type": "REPEAT",
          "content": {
            "type": "SYMBOL",
            "name": "testbed_declaration"
          }
        },
        {
          "type": "STRING",
          "value": "@end"
        },
        {
          "type": "PATTERN",
          "value": "\\n"
        }
      ]
    },
    "testbed_declaration": {
      "type": "SEQ",
      "members": [
        {
          "type": "FIELD",
          "name": "variable",
          "content": {
            "type": "SYMBOL",
            "name": "variable_name"
          }
        },
        {
          "type": "STRING",
          "value": "="
        },
        {
          "type": "FIELD",
          "name": "value",
          "content": {
            "type": "SYMBOL",
            "name": "simple_value"
          }
        },
        {
          "type": "PATTERN",
          "value": "\\n"
        }
      ]
    },
    "block": {
      "type": "SEQ",
      "members": [
        {
          "type": "FIELD",
          "name": "tag",
          "content": {
            "type": "SYMBOL",
            "name": "block_tag"
          }
        },
        {
          "type": "REPEAT",
          "content": {
            "type": "CHOICE",
            "members": [
              {
                "type": "SYMBOL",
                "name": "beat"
              },
              {
                "type": "SYMBOL",
                "name": "logic_beat"
              }
            ]
          }
        },
        {
          "type": "CHOICE",
          "members": [
            {
              "type": "SYMBOL",
              "name": "choices"
            },
            {
              "type": "BLANK"
            }
          ]
        }
      ]
    },
    "block_tag": {
      "type": "SEQ",
      "members": [
        {
          "type": "STRING",
          "value": "#"
        },
        {
          "type": "SYMBOL",
          "name": "identifier"
        },
        {
          "type": "PATTERN",
          "value": "\\n"
        }
      ]
    },
    "attribution": {
      "type": "TOKEN",
      "content": {
        "type": "SEQ",
        "members": [
          {
            "type": "PATTERN",
            "value": "[a-zA-Z_][a-zA-Z0-9_]*"
          },
          {
            "type": "STRING",
            "value": ":"
          }
        ]
      }
    },
    "beat": {
      "type": "PREC_RIGHT",
      "value": 0,
      "content": {
        "type": "SEQ",
        "members": [
          {
            "type": "CHOICE",
            "members": [
              {
                "type": "SYMBOL",
                "name": "conditional"
              },
              {
                "type": "BLANK"
              }
            ]
          },
          {
            "type": "CHOICE",
            "members": [
              {
                "type": "FIELD",
                "name": "attribution",
                "content": {
                  "type": "SYMBOL",
                  "name": "attribution"
                }
              },
              {
                "type": "BLANK"
              }
            ]
          },
          {
            "type": "FIELD",
            "name": "content",
            "content": {
              "type": "SYMBOL",
              "name": "text_content"
            }
          },
          {
            "type": "PATTERN",
            "value": "\\n"
          },
          {
            "type": "REPEAT",
            "content": {
              "type": "SYMBOL",
              "name": "indented_operation"
            }
          }
        ]
      }
    },
    "logic_beat": {
      "type": "CHOICE",
      "members": [
        {
          "type": "SEQ",
          "members": [
            {
              "type": "STRING",
              "value": "*"
            },
            {
              "type": "CHOICE",
              "members": [
                {
                  "type": "SYMBOL",
                  "name": "conditional"
                },
                {
                  "type": "STRING",
                  "value": "(else)"
                }
              ]
            },
            {
              "type": "PATTERN",
              "value": "\\n"
            },
            {
              "type": "REPEAT1",
              "content": {
                "type": "SYMBOL",
                "name": "indented_operation"
              }
            }
          ]
        },
        {
          "type": "SEQ",
          "members": [
            {
              "type": "STRING",
              "value": "*"
            },
            {
              "type": "CHOICE",
              "members": [
                {
                  "type": "SYMBOL",
                  "name": "conditional"
                },
                {
                  "type": "STRING",
                  "value": "(else)"
                }
              ]
            },
            {
              "type": "SYMBOL",
              "name": "operation"
            },
            {
              "type": "PATTERN",
              "value": "\\n"
            }
          ]
        }
      ]
    },
    "text_content": {
      "type": "REPEAT1",
      "content": {
        "type": "CHOICE",
        "members": [
          {
            "type": "SYMBOL",
            "name": "text_fragment"
          },
          {
            "type": "SYMBOL",
            "name": "insertion"
          },
          {
            "type": "SYMBOL",
            "name": "inline_comment"
          }
        ]
      }
    },
    "text_fragment": {
      "type": "TOKEN",
      "content": {
        "type": "PREC",
        "value": -1,
        "content": {
          "type": "PATTERN",
          "value": "[^{}\\n\\r]+"
        }
      }
    },
    "inline_comment": {
      "type": "SEQ",
      "members": [
        {
          "type": "STRING",
          "value": "{--"
        },
        {
          "type": "PATTERN",
          "value": "[^}]*"
        },
        {
          "type": "STRING",
          "value": "}"
        }
      ]
    },
    "insertion": {
      "type": "SEQ",
      "members": [
        {
          "type": "STRING",
          "value": "{"
        },
        {
          "type": "CHOICE",
          "members": [
            {
              "type": "SYMBOL",
              "name": "simple_insertion"
            },
            {
              "type": "SYMBOL",
              "name": "ternary_insertion"
            },
            {
              "type": "SYMBOL",
              "name": "switch_ternary"
            }
          ]
        },
        {
          "type": "STRING",
          "value": "}"
        }
      ]
    },
    "simple_insertion": {
      "type": "SYMBOL",
      "name": "rvalue"
    },
    "ternary_insertion": {
      "type": "SEQ",
      "members": [
        {
          "type": "FIELD",
          "name": "condition",
          "content": {
            "type": "SYMBOL",
            "name": "rvalue"
          }
        },
        {
          "type": "STRING",
          "value": "?"
        },
        {
          "type": "FIELD",
          "name": "true_value",
          "content": {
            "type": "SYMBOL",
            "name": "rvalue"
          }
        },
        {
          "type": "STRING",
          "value": ":"
        },
        {
          "type": "FIELD",
          "name": "false_value",
          "content": {
            "type": "SYMBOL",
            "name": "rvalue"
          }
        }
      ]
    },
    "switch_ternary": {
      "type": "SEQ",
      "members": [
        {
          "type": "FIELD",
          "name": "switch_value",
          "content": {
            "type": "SYMBOL",
            "name": "rvalue"
          }
        },
        {
          "type": "STRING",
          "value": "?"
        },
        {
          "type": "STRING",
          "value": "["
        },
        {
          "type": "SEQ",
          "members": [
            {
              "type": "SYMBOL",
              "name": "switch_case"
            },
            {
              "type": "REPEAT",
              "content": {
                "type": "SEQ",
                "members": [
                  {
                    "type": "STRING",
                    "value": ","
                  },
                  {
                    "type": "SYMBOL",
                    "name": "switch_case"
                  }
                ]
              }
            }
          ]
        },
        {
          "type": "STRING",
          "value": "]"
        }
      ]
    },
    "switch_case": {
      "type": "SEQ",
      "members": [
        {
          "type": "FIELD",
          "name": "key",
          "content": {
            "type": "SYMBOL",
            "name": "simple_value"
          }
        },
        {
          "type": "STRING",
          "value": ":"
        },
        {
          "type": "FIELD",
          "name": "value",
          "content": {
            "type": "SYMBOL",
            "name": "rvalue"
          }
        }
      ]
    },
    "conditional": {
      "type": "SEQ",
      "members": [
        {
          "type": "STRING",
          "value": "(?"
        },
        {
          "type": "FIELD",
          "name": "expression",
          "content": {
            "type": "SYMBOL",
            "name": "conditional_expression"
          }
        },
        {
          "type": "STRING",
          "value": ")"
        }
      ]
    },
    "conditional_expression": {
      "type": "CHOICE",
      "members": [
        {
          "type": "SYMBOL",
          "name": "conditional_clause"
        },
        {
          "type": "SEQ",
          "members": [
            {
              "type": "SYMBOL",
              "name": "conditional_clause"
            },
            {
              "type": "REPEAT1",
              "content": {
                "type": "SEQ",
                "members": [
                  {
                    "type": "CHOICE",
                    "members": [
                      {
                        "type": "STRING",
                        "value": "and"
                      },
                      {
                        "type": "STRING",
                        "value": "or"
                      }
                    ]
                  },
                  {
                    "type": "SYMBOL",
                    "name": "conditional_clause"
                  }
                ]
              }
            }
          ]
        }
      ]
    },
    "conditional_clause": {
      "type": "CHOICE",
      "members": [
        {
          "type": "SEQ",
          "members": [
            {
              "type": "STRING",
              "value": "("
            },
            {
              "type": "SYMBOL",
              "name": "conditional_expression"
            },
            {
              "type": "STRING",
              "value": ")"
            }
          ]
        },
        {
          "type": "SYMBOL",
          "name": "conditional_atom"
        }
      ]
    },
    "conditional_atom": {
      "type": "CHOICE",
      "members": [
        {
          "type": "SEQ",
          "members": [
            {
              "type": "STRING",
              "value": "!"
            },
            {
              "type": "SYMBOL",
              "name": "rvalue"
            }
          ]
        },
        {
          "type": "SYMBOL",
          "name": "rvalue"
        },
        {
          "type": "SEQ",
          "members": [
            {
              "type": "SYMBOL",
              "name": "rvalue"
            },
            {
              "type": "FIELD",
              "name": "operator",
              "content": {
                "type": "CHOICE",
                "members": [
                  {
                    "type": "STRING",
                    "value": "="
                  },
                  {
                    "type": "STRING",
                    "value": "!="
                  },
                  {
                    "type": "STRING",
                    "value": ">"
                  },
                  {
                    "type": "STRING",
                    "value": "<"
                  },
                  {
                    "type": "STRING",
                    "value": ">="
                  },
                  {
                    "type": "STRING",
                    "value": "<="
                  }
                ]
              }
            },
            {
              "type": "SYMBOL",
              "name": "rvalue"
            }
          ]
        }
      ]
    },
    "choices": {
      "type": "REPEAT1",
      "content": {
        "type": "SYMBOL",
        "name": "choice"
      }
    },
    "choice": {
      "type": "SEQ",
      "members": [
        {
          "type": "STRING",
          "value": ">"
        },
        {
          "type": "CHOICE",
          "members": [
            {
              "type": "SYMBOL",
              "name": "conditional"
            },
            {
              "type": "BLANK"
            }
          ]
        },
        {
          "type": "FIELD",
          "name": "text",
          "content": {
            "type": "SYMBOL",
            "name": "text_content"
          }
        },
        {
          "type": "CHOICE",
          "members": [
            {
              "type": "SEQ",
              "members": [
                {
                  "type": "STRING",
                  "value": "->"
                },
                {
                  "type": "FIELD",
                  "name": "target",
                  "content": {
                    "type": "SYMBOL",
                    "name": "identifier"
                  }
                }
              ]
            },
            {
              "type": "BLANK"
            }
          ]
        },
        {
          "type": "PATTERN",
          "value": "\\n"
        },
        {
          "type": "REPEAT",
          "content": {
            "type": "SYMBOL",
            "name": "indented_operation"
          }
        }
      ]
    },
    "indented_operation": {
      "type": "SEQ",
      "members": [
        {
          "type": "PATTERN",
          "value": "[ \\t]+"
        },
        {
          "type": "SYMBOL",
          "name": "operation"
        },
        {
          "type": "PATTERN",
          "value": "\\n"
        }
      ]
    },
    "operation": {
      "type": "CHOICE",
      "members": [
        {
          "type": "SYMBOL",
          "name": "move_op"
        },
        {
          "type": "SYMBOL",
          "name": "go_module_op"
        },
        {
          "type": "SYMBOL",
          "name": "exit_op"
        },
        {
          "type": "SYMBOL",
          "name": "method_call_op"
        },
        {
          "type": "SYMBOL",
          "name": "mutation_op"
        }
      ]
    },
    "move_op": {
      "type": "SEQ",
      "members": [
        {
          "type": "STRING",
          "value": "->"
        },
        {
          "type": "FIELD",
          "name": "target",
          "content": {
            "type": "SYMBOL",
            "name": "identifier"
          }
        }
      ]
    },
    "go_module_op": {
      "type": "SEQ",
      "members": [
        {
          "type": "STRING",
          "value": "GO"
        },
        {
          "type": "FIELD",
          "name": "module",
          "content": {
            "type": "SYMBOL",
            "name": "module_path"
          }
        },
        {
          "type": "CHOICE",
          "members": [
            {
              "type": "SEQ",
              "members": [
                {
                  "type": "STRING",
                  "value": "->"
                },
                {
                  "type": "FIELD",
                  "name": "tag",
                  "content": {
                    "type": "SYMBOL",
                    "name": "identifier"
                  }
                }
              ]
            },
            {
              "type": "BLANK"
            }
          ]
        }
      ]
    },
    "module_path": {
      "type": "PATTERN",
      "value": "[a-zA-Z0-9_\\/]+\\.ska"
    },
    "exit_op": {
      "type": "SEQ",
      "members": [
        {
          "type": "STRING",
          "value": "EXIT"
        },
        {
          "type": "CHOICE",
          "members": [
            {
              "type": "SYMBOL",
              "name": "rvalue"
            },
            {
              "type": "BLANK"
            }
          ]
        }
      ]
    },
    "method_call_op": {
      "type": "SYMBOL",
      "name": "method_call"
    },
    "mutation_op": {
      "type": "SEQ",
      "members": [
        {
          "type": "STRING",
          "value": "~"
        },
        {
          "type": "FIELD",
          "name": "variable",
          "content": {
            "type": "SYMBOL",
            "name": "variable_name"
          }
        },
        {
          "type": "FIELD",
          "name": "operator",
          "content": {
            "type": "CHOICE",
            "members": [
              {
                "type": "STRING",
                "value": "="
              },
              {
                "type": "STRING",
                "value": "+="
              },
              {
                "type": "STRING",
                "value": "-="
              },
              {
                "type": "STRING",
                "value": "=!"
              }
            ]
          }
        },
        {
          "type": "CHOICE",
          "members": [
            {
              "type": "FIELD",
              "name": "value",
              "content": {
                "type": "SYMBOL",
                "name": "rvalue"
              }
            },
            {
              "type": "BLANK"
            }
          ]
        }
      ]
    },
    "rvalue": {
      "type": "CHOICE",
      "members": [
        {
          "type": "SYMBOL",
          "name": "simple_value"
        },
        {
          "type": "SYMBOL",
          "name": "variable_ref"
        },
        {
          "type": "SYMBOL",
          "name": "method_call"
        }
      ]
    },
    "simple_value": {
      "type": "CHOICE",
      "members": [
        {
          "type": "SYMBOL",
          "name": "string"
        },
        {
          "type": "SYMBOL",
          "name": "number"
        },
        {
          "type": "SYMBOL",
          "name": "boolean"
        }
      ]
    },
    "variable_ref": {
      "type": "SYMBOL",
      "name": "variable_name"
    },
    "method_call": {
      "type": "SEQ",
      "members": [
        {
          "type": "STRING",
          "value": ":"
        },
        {
          "type": "FIELD",
          "name": "method",
          "content": {
            "type": "SYMBOL",
            "name": "identifier"
          }
        },
        {
          "type": "STRING",
          "value": "("
        },
        {
          "type": "CHOICE",
          "members": [
            {
              "type": "CHOICE",
              "members": [
                {
                  "type": "SEQ",
                  "members": [
                    {
                      "type": "SYMBOL",
                      "name": "rvalue"
                    },
                    {
                      "type": "REPEAT",
                      "content": {
                        "type": "SEQ",
                        "members": [
                          {
                            "type": "STRING",
                            "value": ","
                          },
                          {
                            "type": "SYMBOL",
                            "name": "rvalue"
                          }
                        ]
                      }
                    }
                  ]
                },
                {
                  "type": "BLANK"
                }
              ]
            },
            {
              "type": "BLANK"
            }
          ]
        },
        {
          "type": "STRING",
          "value": ")"
        }
      ]
    },
    "identifier": {
      "type": "PATTERN",
      "value": "[a-zA-Z_][a-zA-Z0-9_]*"
    },
    "string": {
      "type": "TOKEN",
      "content": {
        "type": "SEQ",
        "members": [
          {
            "type": "STRING",
            "value": "\""
          },
          {
            "type": "REPEAT",
            "content": {
              "type": "CHOICE",
              "members": [
                {
                  "type": "PATTERN",
                  "value": "[^\"\\\\]"
                },
                {
                  "type": "SEQ",
                  "members": [
                    {
                      "type": "STRING",
                      "value": "\\"
                    },
                    {
                      "type": "PATTERN",
                      "value": "."
                    }
                  ]
                }
              ]
            }
          },
          {
            "type": "STRING",
            "value": "\""
          }
        ]
      }
    },
    "number": {
      "type": "PATTERN",
      "value": "\\d+(\\.\\d+)?"
    },
    "boolean": {
      "type": "CHOICE",
      "members": [
        {
          "type": "STRING",
          "value": "true"
        },
        {
          "type": "STRING",
          "value": "false"
        }
      ]
    }
  },
  "extras": [
    {
      "type": "PATTERN",
      "value": "[ \\t\\n]"
    },
    {
      "type": "SYMBOL",
      "name": "comment"
    }
  ],
  "conflicts": [],
  "precedences": [],
  "externals": [],
  "inline": [],
  "supertypes": [],
  "reserved": {}
}